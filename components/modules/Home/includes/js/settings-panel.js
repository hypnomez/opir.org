// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var added_tags, event_filter_tags, filter_category, found_tags, last, map_container, panel, _ref, _ref1;
    if (!$('.cs-home-settings').length) {
      return;
    }
    map_container = $('#map');
    panel = $('.cs-home-settings-panel, .cs-home-settings-coordinator');
    if (!((_ref = cs.home) != null ? _ref.automaidan : void 0) && !((_ref1 = cs.home) != null ? _ref1.automaidan_coord : void 0) && !cs.is_admin) {
      panel.find('[data-id]').each(function() {});
      panel.find('[data-group]:not([data-id])').each(function() {
        var prev;
        prev = $(this).prev();
        if (prev.is('[data-group]:not([data-id])')) {
          return prev.remove();
        }
      });
    }
    $('.cs-home-settings').click(function() {
      var shown;
      shown = panel.css('width') !== '0px';
      map_container.animate({
        right: (shown ? 0 : 310) + 'px'
      }, 'fast', function() {
        return map.container.fitToViewport();
      });
      if (shown) {
        panel.animate({
          width: '0'
        }, 'fast');
        return $(this).animate({
          right: '0'
        }, 'fast').removeClass('uk-icon-chevron-right').addClass('uk-icon-chevron-left');
      } else {
        panel.animate({
          width: '310'
        }, 'fast');
        return $(this).animate({
          right: '310'
        }, 'fast').removeClass('uk-icon-chevron-left').addClass('uk-icon-chevron-right');
      }
    });
    filter_category = $('.cs-home-filter-category');
    filter_category.find('[data-id]').click(function() {
      var $this;
      $this = $(this);
      if ($this.hasClass('active')) {
        $this.removeClass('active');
      } else {
        $(this).parent().find('.active').removeClass('active').end().end().addClass('active');
      }
      return map.update_events(true);
    }).end().find('[data-group]').not('[data-id]').click(function() {
      var group;
      group = $(this).data('group');
      $(".cs-home-filter-category [data-id][data-group=" + group + "]").toggleClass('active');
      return map.update_events(true);
    });
    event_filter_tags = $('.cs-home-filter-tags');
    last = '';
    added_tags = $('.cs-home-added-tags');
    found_tags = $('.cs-home-found-tags');
    event_filter_tags.keyup(function() {
      var val;
      val = event_filter_tags.val();
      if (last === val) {
        return;
      }
      last = val;
      if (val.length > 2) {
        return $.ajax({
          url: 'api/Home/tags',
          data: {
            title: val
          },
          type: 'get',
          success: function(tags) {
            var tag;
            return found_tags.html(((function() {
              var _results;
              _results = [];
              for (tag in tags) {
                tag = tags[tag];
                _results.push("<button data-id=\"" + tag.id + "\"><i class=\"uk-icon-plus\"></i> " + tag.title + "</button>");
              }
              return _results;
            })()).join());
          },
          error: function() {
            return found_tags.html('');
          }
        });
      }
    });
    added_tags.on('click', 'button', function() {
      $(this).remove();
      return map.update_events(true);
    });
    return found_tags.on('click', 'button', function() {
      added_tags.append($(this).detach()[0].outerHTML.replace(/uk-icon-plus/, 'uk-icon-times'));
      map.update_events(true);
      last = '';
      return event_filter_tags.val('');
    });
  });

}).call(this);
